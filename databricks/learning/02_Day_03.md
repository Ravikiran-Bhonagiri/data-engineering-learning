# Day 3: Databricks SQL (DBSQL)

**Time:** 1-2 hours  
**Goal:** Build data warehousing capabilities using SQL Warehouses, Queries, and Dashboards.

---

## ðŸ­ SQL Warehouses

A **SQL Warehouse** (formerly SQL Endpoint) is a compute resource optimized for running SQL queries (not Python/Spark jobs).

### Types:
1. **Serverless (Recommended):**
   - Instant startup (seconds).
   - Databricks manages the underlying infrastructure.
   - Autoscaling based on query load.
2. **Pro:** Supports Photon, row-level security.
3. **Classic:** Runs on VM instances in your account (slower startup).

---

## ðŸ”Ž Query Editor

The interface for analysts to run SQL.
- **Schema Browser:** View catalogs, tables, and columns.
- **Visualizations:** Create charts directly from query results (Bar, Line, Pivot, Map).
- **AI Assistant:** "Write a query to aggregate sales by region" -> Generates SQL.

---

## ðŸ“Š Dashboards

Databricks Dashboards (Lakeview) are built directly on top of datasets.
1. **Canvas:** Drag-and-drop visuals.
2. **Data:** Define datasets using SQL.
3. **Publish:** Share with stakeholders (even those without full workspace access).

---

## âš¡ Query History & Profiling

Use the **Query History** page to debug slow queries.

**Look for:**
- **Duration:** Total time.
- **Rows returned.
- **Compilation time.**
- **Query Profile:** The execution plan visualization.
    - *Scan:* Reading data (Is it pruning partitions?).
    - *Shuffle:* Moving data (Is the join expensive?).
    - *Spill to Disk:* (Is memory insufficient?).

---

## ðŸš¨ Alerts

Set up alerts based on SQL query results.
*Example:* Run a query every hour checking for `NULL` IDs. If count > 0, send email/Slack.

```sql
SELECT count(*) as bad_records FROM silver_orders WHERE order_id IS NULL
```
Trigger condition: `Value > 0`

---

## ðŸŽ¯ Interview Q&A

**Q: What is the difference between an All-Purpose Cluster and a SQL Warehouse?**
A:
- **All-Purpose Cluster:** Runs Spark code (Python, Scala, SQL). Start-up takes minutes. Best for Data Engineering/DS.
- **SQL Warehouse:** Optimized query engine specifically for SQL Concurrency and BI. Start-up is instant (Serverless). Best for Analysts and BI tools (Tableau, PowerBI).

**Q: How does Serverless SQL Warehouse reduce cost?**
A: It scales up/down instantly. It terminates aggressively when idle (no 15-minute wait). It avoids over-provisioning because the cloud provider pool is managed by Databricks.

**Q: Can I run Python UDFs in a SQL Warehouse?**
A: Yes, recently Python UDFs (Public Preview) are supported, but generally, SQL Warehouses are designed for pure SQL workloads. For complex Python logic, use a Cluster.

---

**Next:** [Day 4: Medallion Architecture](./02_Day_04.md)
