# ğŸ—“ï¸ Day 10: Indexing & Performance

## ğŸ“š Topics Covered
- Index types (B-tree, composite)
- EXPLAIN ANALYZE
- Query optimization
- Star vs Snowflake schema
- Partitioning basics

---

## ğŸ¯ Problem 1: Create Basic Index
**Difficulty: Easy** | **Concept: B-tree index**

Create an index on customer_id in orders table.

```sql
-- Write your solution here
```

<details>
<summary>ğŸ’¡ Click for Solution</summary>

```sql
-- Single column index
CREATE INDEX idx_orders_customer_id ON orders(customer_id);

-- Verify it exists
SELECT indexname, indexdef 
FROM pg_indexes 
WHERE tablename = 'orders';
```
</details>

---

## ğŸ¯ Problem 2: Composite Index
**Difficulty: Medium** | **Concept: Multi-column index**

Create composite index for customer + date queries.

```sql
-- Write your solution here
```

<details>
<summary>ğŸ’¡ Click for Solution</summary>

```sql
-- Composite index (order matters!)
CREATE INDEX idx_orders_customer_date 
ON orders(customer_id, order_date);

-- This index helps these queries:
-- WHERE customer_id = 1
-- WHERE customer_id = 1 AND order_date > '2024-01-01'

-- But NOT this query efficiently:
-- WHERE order_date > '2024-01-01' (customer_id not used first)
```
</details>

---

## ğŸ¯ Problem 3: EXPLAIN Query Plan
**Difficulty: Medium** | **Concept: Reading EXPLAIN**

Analyze a query's execution plan.

```sql
-- Write your solution here
```

<details>
<summary>ğŸ’¡ Click for Solution</summary>

```sql
-- Basic explain
EXPLAIN SELECT * FROM orders WHERE customer_id = 1;

-- With actual timing
EXPLAIN ANALYZE SELECT * FROM orders WHERE customer_id = 1;

-- Verbose with costs
EXPLAIN (ANALYZE, BUFFERS, FORMAT TEXT)
SELECT o.*, c.name
FROM orders o
JOIN customers c ON o.customer_id = c.id
WHERE o.amount > 1000;
```

**Look for:**
- Seq Scan vs Index Scan
- Cost (startup..total)
- Actual time
- Rows estimated vs actual
</details>

---

## ğŸ¯ Problem 4: Optimize Slow Query
**Difficulty: Hard** | **Concept: Query rewriting**

Optimize this query.

```sql
-- Original
SELECT * FROM orders 
WHERE customer_id IN (
    SELECT id FROM customers WHERE city = 'New York'
);
```

<details>
<summary>ğŸ’¡ Click for Solution</summary>

```sql
-- Optimized version 1: JOIN
SELECT o.*
FROM orders o
JOIN customers c ON o.customer_id = c.id
WHERE c.city = 'New York';

-- Optimized version 2: EXISTS
SELECT o.*
FROM orders o
WHERE EXISTS (
    SELECT 1 FROM customers c 
    WHERE c.id = o.customer_id AND c.city = 'New York'
);

-- Also add indexes:
CREATE INDEX idx_customers_city ON customers(city);
CREATE INDEX idx_orders_customer ON orders(customer_id);
```
</details>

---

## ğŸ¯ Problem 5: Partial Index
**Difficulty: Medium** | **Concept: Conditional index**

Create index only for pending orders.

```sql
-- Write your solution here
```

<details>
<summary>ğŸ’¡ Click for Solution</summary>

```sql
-- Partial index (smaller, more efficient)
CREATE INDEX idx_orders_pending 
ON orders(order_date) 
WHERE status = 'pending';

-- This query uses the partial index
EXPLAIN ANALYZE
SELECT * FROM orders 
WHERE status = 'pending' AND order_date > '2024-01-01';
```
</details>

---

## ğŸ¯ Problem 6: Query Anti-Patterns
**Difficulty: Medium** | **Concept: What to avoid**

Identify and fix slow query patterns.

```sql
-- Find the problems here
```

<details>
<summary>ğŸ’¡ Click for Solution</summary>

```sql
-- âŒ SELECT * (fetches all columns)
SELECT * FROM orders;
-- âœ… Better
SELECT id, amount FROM orders;

-- âŒ Function on indexed column
SELECT * FROM employees WHERE YEAR(hire_date) = 2024;
-- âœ… Better
SELECT * FROM employees 
WHERE hire_date >= '2024-01-01' AND hire_date < '2025-01-01';

-- âŒ Leading wildcard
SELECT * FROM customers WHERE email LIKE '%@gmail.com';
-- âœ… Can use index
SELECT * FROM customers WHERE email LIKE 'john%';

-- âŒ Missing LIMIT on large results
SELECT * FROM orders ORDER BY order_date DESC;
-- âœ… Better
SELECT * FROM orders ORDER BY order_date DESC LIMIT 100;
```
</details>

---

## ğŸ¯ Problem 7: Star Schema Design
**Difficulty: Medium** | **Concept: Data warehouse**

Design a star schema for sales analytics.

```sql
-- Write your design here
```

<details>
<summary>ğŸ’¡ Click for Solution</summary>

```sql
-- FACT TABLE (center of star)
CREATE TABLE fact_sales (
    sale_id SERIAL PRIMARY KEY,
    date_key INT,
    product_key INT,
    customer_key INT,
    quantity INT,
    amount DECIMAL(10,2)
);

-- DIMENSION TABLES
CREATE TABLE dim_date (
    date_key INT PRIMARY KEY,
    full_date DATE,
    year INT,
    quarter INT,
    month INT,
    day_of_week VARCHAR(10)
);

CREATE TABLE dim_product (
    product_key INT PRIMARY KEY,
    product_name VARCHAR(100),
    category VARCHAR(50)
);

CREATE TABLE dim_customer (
    customer_key INT PRIMARY KEY,
    customer_name VARCHAR(100),
    city VARCHAR(100)
);
```

**Star vs Snowflake:**
- Star: Denormalized, faster queries
- Snowflake: Normalized dimensions, less storage
</details>

---

## ğŸ“ Day 10 Interview Questions

1. **When NOT to create an index?**
   - Small tables
   - Frequently updated columns
   - Low cardinality (few unique values)

2. **Clustered vs Non-Clustered Index?**
   - Clustered: Data physically ordered, ONE per table
   - Non-clustered: Separate structure with pointers

3. **How to identify slow queries?**
   - Use EXPLAIN ANALYZE
   - Look for Seq Scans on large tables
   - Check for missing indexes

4. **Star vs Snowflake Schema?**
   - Star: Faster queries, more storage
   - Snowflake: Slower queries, less storage

---

## âœ… Day 10 Checklist

- [ ] Completed all 7 problems
- [ ] Can create and evaluate indexes
- [ ] Know how to read EXPLAIN output
- [ ] Understand query anti-patterns
- [ ] Know star schema basics

---

## ğŸ‰ Course Complete!

Congratulations on completing all 10 days! You've covered:
- âœ… Basic CRUD operations
- âœ… Aggregations and GROUP BY
- âœ… All types of JOINs
- âœ… Subqueries and CTEs
- âœ… Window functions
- âœ… Recursive CTEs
- âœ… Procedures and triggers
- âœ… Transactions
- âœ… Indexing and performance

**Next Steps:**
- Practice on LeetCode SQL
- Work with real datasets
- Learn database-specific features
